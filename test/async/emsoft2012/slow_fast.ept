
open Iostream
open Htime
open Utils

const stuff : int = 1
const delay : int = 0

unsafe node slow (h:float; s:float) = (o:float)
var x :int;
let
  x = Do.stuff(3*stuff);
  o = s +. (3.14 *. h);
tel

unsafe node fast (h:float; s:float) = (o:float) 
var x :int;
let
  x = Do.stuff(1*stuff);
  o = s +. (3.0 *. h);
tel

unsafe node main() = (y :float)
var big :bool; yf :float; ys :future float
let
  ys = (async 0.0) fby<<1>> async<<delay>> slow(1.0, !ys);
  yf = 0.0 fby fast(1.0/.3.0, y);
  big = period<<3>>();
  y = merge big (!ys) (yf whenot big);
(*  () = printf("date : %l", get_um_time());
  () = printf("y : %f", y);*)
tel

unsafe node mainfast() = ()
var y : float;
let
  y = 0.0 fby fast(1.0/.3.0, y);
tel

unsafe node mainslow() = ()
var y : float;
let
  y = 0.0 fby slow(1.0, y);
tel

